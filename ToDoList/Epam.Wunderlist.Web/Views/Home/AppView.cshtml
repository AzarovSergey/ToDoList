
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>AppView</title>
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/reset.css" rel="stylesheet" />
    <link href="~/Content/normalize.css" rel="stylesheet" />
    <link href="~/Content/font-awesome.min.css" rel="stylesheet" />
    <link href="~/Content/Site.css" rel="stylesheet"/>
    <script src="~/Scripts/jquery-1.10.2.min.js"></script>
    <script src="~/Scripts/angular.js"></script>
    <script src="~/Scripts/Site.js"></script>
</head>
<body ng-app="app" ng-controller="main">
    <div id="background-container"></div>
    <div id="left-container">
        <div id="left">
            <div id="top-left">
                <span id="menu-toggle-button" class="fa fa-bars glyph-button"></span>
                <input type="text" class="input-search" />
                <span id="search-button" class="fa fa-search"></span>
            </div>
            <div id="folder-menu">
                <div>
                    <span id="user-info-button">
                        <img src="~/Content/Images/logo.png" width="40" height="40" />
                        <span id="username" class="folder-title">Sergey</span>
                        <span class="glyphicon glyphicon-chevron-down"></span>
                    </span>
                    <span id="activities-button" class="fa fa-bell-o"></span>
                </div>

                <div id="user-info">
                    <div class="user-info-item">
                        <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#modal-1">Profile</button></div>
                    <div class="user-info-item"><a href="/account/logout/">logout</a></div>
                </div>

                <div id="folder-container">
                    <div class="folder" ng-repeat="folder in folders">
                        <div class="folder-description" ng-click="ToggleFolder($event);">
                            <span class="left-side">
                                <img src="/Content/Images/logo.png" width="40" height="40">
                                <span class="folder-title">{{folder.Name}}</span>
                            </span>
                        </div>
                        <div class="to-do-list-container">
                            <div class="to-do-list" ng-repeat="todolist in folder.ToDoLists" ng-click="SetSelectedToDoList(todolist.Id);">
                                <span>{{todolist.Name}}</span>
                                <span class="right-side">
                                    <span class="missed">3</span>
                                    <span class="total">6</span>
                                </span>
                            </div>
                        </div>
                    </div> @* .folder*@
                </div> @* #folder-container*@
            </div> @* #folder-menu*@ 
        </div> @*left*@
    </div>

    <div id="center">
        <div id="top-line">
            folder name here
        </div>
        <div id="add-item">
            <span class="fa fa-plus" id="add-item-icon"></span>
            <input type="text" @*id="add-item-input"*@ onkeypress="AddItem(event);" />
        </div>
        <div id="active-item-container">
            <div class="task" ng-repeat="item in items">
                <span class="checkbox-item"></span>
                <span>{{item.Name}}</span>
            </div>
        </div>
    </div>
    <script>
        var SelectedToDoListId=undefined;
        var http;
        var scope;
        
        $('#user-info').hide();
        $('#user-info-button').click(function () {
            $('#user-info').toggle();
        });

        var isLeftHide = false;
        $('#menu-toggle-button').click(function () {
            if (isLeftHide) {
                $('#left-container').css('width', '300px');
                $('#center').css('left', '300px');
            } else {
                $('#left-container').css('width', '50px');
                $('#center').css('left', '50px');
            }
            isLeftHide ^= true;
        });


        var app = angular.module('app', []);
        app.controller('main', function ($scope, $http) {
            http = $http;
            scope = $scope;
            $scope.items = [];
            $http.get('/folder/GetFolders/').then(function (responce) {
                $scope.folders = responce.data;
                //console.log(responce);
            });

            $scope.ToggleFolder = function (event) {
                $(event.currentTarget).siblings('.to-do-list-container').toggle(500);
                //console.log(event);
            };

            $scope.SetSelectedToDoList = function (Id) {
                $http.get('/item/GetItems?toDoListId=' + Id).then(function (responce) {
                    $scope.items = responce.data;
                    SelectedToDoListId=Id;
                    console.log(responce);
                });
            }

            $http.get('/account/UserAccount').then(function (responce) {
                $scope.user = responce.data;
                console.log($scope.user);
            });
        });

        function ItemUrlSuffix(name, toDoListId, isStarred, orderIndex, note, isCompleted, dueDateTime, id) {
            id = id || 0;
            dueDateTime = dueDateTime || 0;
            isCompleted = isCompleted || false;
            note = note || "p";
            orderIndex = orderIndex || 0;
            isStarred = isStarred || false;
            return "?Name=" + name + "&Id=" + id + "&ToDoListId=" + toDoListId + "&DueDateTime=" + dueDateTime + "&IsStarred=" + isStarred + "&OrderIndex=" + orderIndex + "&Note=" + note + "&IsComleted=" + isCompleted;
        }

        function AddItem(event) {
            console.log(event);
            if (event.keyCode === 13) {
                if (SelectedToDoListId === undefined)
                    return;
                var path="/item"+ItemUrlSuffix(event.target.value,SelectedToDoListId);
                $.ajax({
                    method:'POST',
                    url: path,
                    success: function (responce) {
                        //alert('success');
                        scope.SetSelectedToDoList(SelectedToDoListId);
                    },
                    error: function (responce) {
                        console.log(responce);
                        alert('error');
                    }
                });
            }
        }
    </script>

    <div class="modal fade" id="modal-1">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" type="button" data-dismiss="modal">
                        <i class="fa fa-close"></i>
                    </button>
                    <h4 class="modal-title">Profile</h4>
                    <div style="width:100px;height:100px;background-color:cadetblue"></div>
                </div>
                <div class="modal-body">
                    <form id="profile">
                        <dl>
                            <dt>Name</dt>
                            <dd><input type="text" value="{{user.Name}}"/></dd>
                            <dt>Email</dt>
                            <dd>
                                <input type="text" value="{{user.Email}}" />
                                <button class="btn btn-default">Change Email</button>
                            </dd>
                        </dl>
                    </form>
                    <form id="change-pass">
                        <input type="text" placeholder="Current Password"/>
                        <input type="text" placeholder="New password"/>
                        <input type="text" placeholder="Repeat New Password"/>
                        <button class="btn btn-info">Save</button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-info" type="button" data-dismiss="modal">
                        Done
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="~/Scripts/bootstrap.js"></script>
</body>
</html>
